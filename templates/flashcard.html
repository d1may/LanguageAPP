{% extends "base.html" %}

{% block title %}Flashcard{% endblock %}

{% block extra_head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', path='/flashcard.css') }}" data-theme-sheet="amber">
  <link rel="stylesheet" href="{{ url_for('static', path='/flashcard.sapphire.css') }}" data-theme-sheet="sapphire" disabled>
{% endblock %}

{% block body_class %}flashcard{% endblock %}

{% block header %}
  {% include "partials/header.html" %}
{% endblock %}

{% block content %}
<main class="flashcard-shell">
  <section class="flashcard-hero">
    <div>
      <p class="hero-label">Smart repetition</p>
      <h1>Flashcard workouts</h1>
      <p class="hero-desc">
        Cycle through curated decks, flip cards to reveal translations, and grade how well you remember each phrase.
      </p>
      <div class="hero-actions">
        <button class="btn primary" type="button" id="btn-start-session">Start new session</button>
        <button class="btn ghost" type="button" id="btn-import-deck">Import deck</button>
      </div>
    </div>
    <div class="hero-stats">
      <div class="stat-card">
        <p class="stat-label">Due today</p>
        <p class="stat-value" data-due-cards-value>{{ due_cards or 0 }} cards</p>
        <span class="trend up">Ready for review</span>
      </div>
      <div class="stat-card alt">
        <p class="stat-label">Words logged</p>
        <p class="stat-value" data-total-cards-value>{{ total_cards or 0 }}</p>
        <span class="trend neutral">Across all decks</span>
      </div>
    </div>
  </section>

  <section class="flashcard-body">
    <aside class="deck-panel">
      <header class="panel-head">
        <div>
          <p class="panel-label">Decks</p>
          <h2>Pick focus</h2>
        </div>
        <button class="icon-btn small ghost" id="btn-open-deck-modal" type="button" aria-haspopup="dialog" aria-controls="deck-create-modal">ï¼‹</button>
      </header>

      <div class="deck-filter">
        <input type="search" placeholder="Search decksâ€¦" data-deck-search autocomplete="off">
      </div>

      <ul class="deck-list" data-deck-list></ul>
      <p class="deck-empty" data-deck-empty hidden>No decks yet. Create your first one!</p>
    </aside>

    <div class="card-panel">
      <header class="panel-head card-head" data-active-deck-head hidden>
        <div class="card-head-info">
          <p class="panel-label" data-active-deck-meta>Deck focus</p>
          <h2 data-active-deck-title>â€”</h2>
          <div class="chip-list" data-word-stats hidden>
            <span class="chip" data-word-count>0 cards</span>
          </div>
        </div>
        <div class="card-head-actions">
          <button class="btn primary" type="button" id="btn-deck-study" disabled>Study</button>
          <button class="btn secondary" type="button" id="btn-deck-add" disabled>Add</button>
          <button class="btn tertiary" type="button" id="btn-deck-edit" disabled>
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn destructive" type="button" id="btn-deck-delete" disabled>
            <i class="bi bi-trash-fill"></i>
          </button>
          <button class="btn tertiary" type="button" id="btn-deck-export" disabled aria-label="Export deck">
            <i class="bi bi-download"></i>
          </button>
        </div>
      </header>

      <div class="card-filter" data-card-filter hidden>
        <input type="search" placeholder="Search cardsâ€¦" data-word-search autocomplete="off">
      </div>

      <div class="card-panel-body">
        <div class="word-list-empty" data-word-placeholder>
          <p data-placeholder-text>Choose a deck to start reviewing cards.</p>
          <p class="word-list-advice" data-placeholder-tip></p>
        </div>
        <ul class="word-card-list" data-word-list hidden></ul>
      </div>
    </div>
  </section>
</main>

<div class="session-empty-modal" id="session-empty-modal" aria-hidden="true">
  <div class="session-empty-backdrop" data-session-empty-close></div>
  <div class="session-empty-card">
    <h3>No cards ready</h3>
    <p>Add more cards and boost that vocabulary! ðŸš€</p>
    <button class="btn primary" type="button" data-session-empty-close>Got it</button>
  </div>
</div>

<div class="deck-modal" id="deck-create-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="deck-modal-title">
  <div class="deck-modal-backdrop" data-modal-close></div>
  <div class="deck-modal-content">
    <header class="deck-modal-head">
      <div>
        <p class="panel-label">New deck</p>
        <h3 id="deck-modal-title">Create flashcard set</h3>
      </div>
      <button class="icon-btn small ghost" type="button" data-modal-close>Close</button>
    </header>
    <form class="deck-modal-form" id="deck-create-form">
      <label class="deck-field">
        <span>Title</span>
        <input type="text" name="title" placeholder="Business idioms" maxlength="40" required>
      </label>
      <label class="deck-field">
        <span>Description</span>
        <textarea name="description" rows="3" placeholder="What will learners master with this deck?" maxlength="40" required></textarea>
      </label>
      <label class="deck-field">
        <span>Category</span>
        <select name="category">
          <option value="">Choose category</option>
          <option value="business">Business</option>
          <option value="travel">Travel</option>
          <option value="daily">Daily usage</option>
          <option value="custom">Custom</option>
        </select>
      </label>
      <label class="deck-field">
        <span>Language</span>
        <select name="lang" required>
          <option value="en">English</option>
          <option value="de">Deutsch</option>
        </select>
      </label>
      <div class="deck-modal-actions">
        <button class="btn ghost" type="button" data-modal-close>Cancel</button>
        <button class="btn primary" type="submit">Save deck</button>
      </div>
    </form>
    <p class="deck-modal-hint" data-modal-hint>Decks will sync once backend wiring is in place.</p>
  </div>
</div>

<div class="deck-modal" id="deck-import-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="deck-import-title">
  <div class="deck-modal-backdrop" data-modal-close></div>
  <div class="deck-modal-content">
    <header class="deck-modal-head">
      <div>
        <p class="panel-label">Import deck</p>
        <h3 id="deck-import-title">Upload CSV</h3>
      </div>
      <button class="icon-btn small ghost" type="button" data-modal-close>Close</button>
    </header>
    <form class="deck-modal-form" id="deck-import-form" enctype="multipart/form-data">
      <label class="deck-field">
        <span>Title</span>
        <input type="text" name="title" placeholder="My study set" maxlength="40" required>
      </label>
      <label class="deck-field">
        <span>Description</span>
        <textarea name="description" rows="3" placeholder="Short summary" maxlength="45" required></textarea>
      </label>
      <label class="deck-field">
        <span>Category</span>
        <select name="category">
          <option value="">Choose category</option>
          <option value="business">Business</option>
          <option value="travel">Travel</option>
          <option value="daily">Daily usage</option>
          <option value="custom">Custom</option>
        </select>
      </label>
      <label class="deck-field">
        <span>Language</span>
        <select name="lang" required>
          <option value="en">English</option>
          <option value="de">Deutsch</option>
        </select>
      </label>
      <label class="deck-field">
        <span>CSV file</span>
        <input type="file" name="file" accept=".csv,text/csv" required>
      </label>
      <div class="deck-modal-actions">
        <button class="btn ghost" type="button" data-modal-close>Cancel</button>
        <button class="btn primary" type="submit">Import deck</button>
      </div>
    </form>
    <p class="deck-modal-hint" data-import-hint>CSV must include Word & Definition columns; Example and Difficulty are optional.</p>
  </div>
</div>

<div class="deck-modal" id="word-create-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="word-modal-title">
  <div class="deck-modal-backdrop" data-modal-close></div>
  <div class="deck-modal-content">
    <header class="deck-modal-head">
      <div>
        <p class="panel-label">New card</p>
        <h3 id="word-modal-title"><span data-word-modal-title-text>Add to</span> <span data-word-modal-deck>deck</span></h3>
      </div>
      <button class="icon-btn small ghost" type="button" data-modal-close>Close</button>
    </header>
    <form class="deck-modal-form" id="word-create-form">
      <label class="deck-field">
        <span>Word</span>
        <input type="text" name="word" placeholder="e.g. Momentum" maxlength="50" required>
      </label>
      <label class="deck-field">
        <span>Definition</span>
        <textarea name="definition" rows="3" placeholder="Short explanation" maxlength="100" required></textarea>
      </label>
      <label class="deck-field">
        <span>Example</span>
        <textarea name="example" rows="2" placeholder="Optional usage example" maxlength="100"></textarea>
      </label>
      <div class="deck-modal-actions">
        <button class="btn ghost" type="button" data-modal-close>Cancel</button>
        <button class="btn primary" type="submit">Save card</button>
      </div>
    </form>
    <p class="deck-modal-hint" data-word-modal-hint>Add cards to keep this deck growing.</p>
  </div>
</div>

<div class="deck-modal" id="word-delete-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="word-delete-title">
  <div class="deck-modal-backdrop" data-modal-close></div>
  <div class="deck-modal-content confirm">
    <header class="deck-modal-head">
      <div>
        <p class="panel-label">Delete card</p>
        <h3 id="word-delete-title" data-word-delete-title>Delete card</h3>
      </div>
      <button class="icon-btn small ghost" type="button" data-modal-close>Close</button>
    </header>
    <p class="confirm-message">Are you sure you want to delete <span data-word-delete-label>this card</span>? This action cannot be undone.</p>
    <div class="deck-modal-actions confirm-actions">
      <button class="btn ghost" type="button" data-modal-close>Cancel</button>
      <button class="btn danger" type="button" id="btn-confirm-delete">Delete</button>
    </div>
  </div>
</div>

<div class="deck-modal" id="deck-delete-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="deck-delete-title">
  <div class="deck-modal-backdrop" data-modal-close></div>
  <div class="deck-modal-content confirm">
    <header class="deck-modal-head">
      <div>
        <p class="panel-label">Delete deck</p>
        <h3 id="deck-delete-title">Delete deck</h3>
      </div>
      <button class="icon-btn small ghost" type="button" data-modal-close>Close</button>
    </header>
    <p class="confirm-message">
      Are you sure you want to delete <span data-deck-delete-label>this deck</span>? All cards inside will be removed.
    </p>
    <div class="deck-modal-actions confirm-actions">
      <button class="btn ghost" type="button" data-modal-close>Cancel</button>
      <button class="btn danger" type="button" id="btn-confirm-deck-delete">Delete deck</button>
    </div>
  </div>
</div>

<div class="deck-modal study-modal" id="study-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="study-modal-title">
  <div class="deck-modal-backdrop" data-modal-close></div>
  <div class="deck-modal-content">
    <header class="deck-modal-head">
      <div>
        <p class="panel-label">Study session</p>
        <h3 id="study-modal-title">Review <span data-study-deck>deck</span></h3>
      </div>
      <button class="icon-btn small ghost" type="button" data-modal-close>Close</button>
    </header>
    <div class="study-body">
      <p class="study-empty" data-study-empty hidden>Add cards to this deck to start studying.</p>
      <div class="active-card" data-study-card hidden>
        <div class="card-face front">
          <p class="card-label">Prompt</p>
          <h3 data-study-word>â€”</h3>
        </div>
        <div class="card-face back">
          <p class="card-label">Definition</p>
          <p class="card-desc" data-study-definition>â€”</p>
          <p class="card-example" data-study-example-wrap hidden>
            <span>Example:</span>
            <em data-study-example></em>
          </p>
        </div>
        <button class="card-toggle" type="button" id="btn-study-flip">Flip card</button>
      </div>
      <p class="study-summary" data-study-summary hidden>Session complete.</p>
      <div class="review-actions" data-study-actions hidden>
        <button class="btn ghost danger" type="button" id="btn-study-unknown">Don't know</button>
        <button class="btn primary" type="button" id="btn-study-known">I knew this</button>
      </div>
      <div class="session-footer">
        <p data-study-progress>â€”</p>
        <button class="link-btn" type="button" data-modal-close>End session</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script type="module" src="{{ url_for('static', path='/main-app.js') }}"></script>
{% endblock %}
